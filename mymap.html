<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Draw &amp; animate a line on a map</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>
<div id='map'></div>

<script>
L.mapbox.accessToken = 'pk.eyJ1Ijoid3liZXJ0IiwiYSI6Ik9WNGtlaEEifQ.xSQ8zVV5GcMouyl_ervEOQ';
var map = L.mapbox.map('map', 'mapbox.streets')
    .setView([30.537177000,114.359481000], 14);

// Add a new line to the map with no points.
var polyline = L.polyline([]).addTo(map);

// Keep a tally of how many points we've added to the map.
var pointsAdded = 0;




// load json file


var xmlhttp = new XMLHttpRequest();
    // json file direction
var url = "14.json";

var line =[]

 var myArr = JSON.parse(xmlhttp.responseText);
            myFunction(myArr);
            
// xmlhttp.onreadystatechange = function() {
//         if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
//             var myArr = JSON.parse(xmlhttp.responseText);
//             myFunction(myArr);

//         }





    // }
    xmlhttp.open("GET", url, true);
    xmlhttp.send();



    function myFunction(arr) {
        var line = [];
        var i;
        for(i = 0; i < arr.length; i++) {
           line.push( L.latLng(arr[i].lat,arr[i].lon))

        }

        // return line
    }



// var line = [ L.latLng(30.537382000,114.359821000),
//              L.latLng(30.537177000,114.359481000),
//              L.latLng(30.537106000,114.359391000),
//              L.latLng(30.537045000,114.359290000),
//              L.latLng(30.536430000,114.358738000),
//              L.latLng(30.536358000,114.358818000),
//              L.latLng(30.536202000,114.359221000),
//              L.latLng(30.536161000,114.359319000),
//              L.latLng(30.536023000,114.359788000),
//              L.latLng(30.536002000,114.359892000),
//              L.latLng(30.535963000,114.360005000),
//              L.latLng(30.535926000,114.360243000),
//              L.latLng(30.535913000,114.360357000)]




// Start drawing the polyline.


    add();
             
// var oneline = line[0];

function add() {

    // `addLatLng` takes a new latLng coordinate and puts it at the end of the
    // line. You optionally pull points from your data or generate them. Here
    // we make a sine wave with some math.


    





    // var line = [ L.latLng(30.537382000,114.359821000),
    //          L.latLng(30.537177000,114.359481000),
    //          L.latLng(30.537106000,114.359391000),
    //          L.latLng(30.537045000,114.359290000),
    //          L.latLng(30.536430000,114.358738000),
    //          L.latLng(30.536358000,114.358818000),
    //          L.latLng(30.536202000,114.359221000),
    //          L.latLng(30.536161000,114.359319000),
    //          L.latLng(30.536023000,114.359788000),
    //          L.latLng(30.536002000,114.359892000),
    //          L.latLng(30.535963000,114.360005000),
    //          L.latLng(30.535926000,114.360243000),
    //          L.latLng(30.535913000,114.360357000)]

    polyline.addLatLng(line[pointsAdded]);

    // Pan the map along with where the line is being added.
    // map.setView([0, pointsAdded], 3);

    // Continue to draw and pan the map by calling `add()`
    // until `pointsAdded` reaches 360.

    // if (++pointsAdded < 360) window.setTimeout(add, 100);

    if (++pointsAdded < 13) window.setTimeout(add, 100);
    // for (var i = 0; i < 13; i++){
    // // will run 5 times
    // oneline = line[i];
    // window.setTimeout(add, 100);
// };
}
</script>
</body>
</html>